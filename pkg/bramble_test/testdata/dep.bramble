load("github.com/maxmcd/bramble")


def busy_wrap():
    bb = bramble.busybox()
    return derivation(
        name="busy_wrap",
        outputs=["out", "docs"],
        builder=bb.out + "/bin/sh",
        env=dict(PATH=bb.out + "/bin", bb=bb.out),
        args=[
            "-c",
            """
		set -e

		cp -r $bb/bin $out/

		echo "here are the docs" > $docs/doc.txt
		""",
        ],
    )


def ok():
    bb = busy_wrap()
    return derivation(
        name="ok",
        builder=bb.out + "/bin/sh",
        env=dict(PATH=bb.out + "/bin", bb=bb.out),
        args=[
            "-c",
            """
		set -e

		mkdir -p $out/bin
		touch $out/bin/say-hi
		chmod +x $out/bin/say-hi

		echo "#!$bb/bin/sh" > $out/bin/say-hi
		echo "$bb/bin/echo hi" >> $out/bin/say-hi

		$out/bin/say-hi
		""",
        ],
    )
